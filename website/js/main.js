/*{
  "NumEntries": 5,
  "Entries": [
    {
      "TicketID": 837522,
      "TicketParentID": 804689,
      "Title": "QA",
      "CompanyName": "Klick Inc.",
      "AccountPortfolioName": "Genome",
      "ProjectID": 10424,
      "ProjectName": "Genome",
      "TicketStatusID": 410,
      "TicketStatusName": "open",
      "AssigneeUserID": 5164,
      "AssigneeUserFullName": "Dan Van Brunt",
      "AssignerUserID": 5164,
      "AssignerUserFullName": "Dan Van Brunt",
      "Description": "This will require a sitdown with someone from the GenomeFS team to solution around some testing flows and how to do it in UAT.&nbsp;<div><br></div><div>Please reach out to DVB or setup a meeting</div>",
      "Created": "/Date(1429729499760-0000)/",
      "CreatorUserID": 5164,
      "CreatorUserFullName": "Dan Van Brunt",
      "Priority": 5,
      "ClientCanView": false,
      "Updated": "/Date(1431006118893-0000)/",
      "UpdaterUserID": 5164,
      "RecentComments": [],
      "ChecklistItems": []
    },
    {
      "TicketID": 832800,
      "TicketParentID": 0,
      "Title": "GScheduler",
      "CompanyName": "Klick Inc.",
      "AccountPortfolioName": "Genome",
      "ProjectID": 16798,
      "ProjectName": "Scheduler",
      "TicketStatusID": 410,
      "TicketStatusName": "open",
      "AssigneeUserID": 5164,
      "AssigneeUserFullName": "Dan Van Brunt",
      "AssignerUserID": 4323,
      "AssignerUserFullName": "Genome ",
      "Description": "- Fix defects in github<div>- Complete Enhancements</div><div><br></div><div><b>Github</b></div><div>https://github.com/iDVB/chrome-gscheduler<br></div><div><br></div><div><b>GDrive</b></div><div>http://goo.gl/8M4N9D</div>",
      "Created": "/Date(1429129905530-0000)/",
      "CreatorUserID": 5164,
      "CreatorUserFullName": "Dan Van Brunt",
      "Priority": 5,
      "Deadline": "/Date(1429308000000-0000)/",
      "ClientCanView": false,
      "Updated": "/Date(1429696824450-0000)/",
      "UpdaterUserID": 5486,
      "LastViewDate": "/Date(1432563330760-0000)/",
      "RecentComments": [],
      "ChecklistItems": []
    },
    {
      "TicketID": 830127,
      "TicketParentID": 804689,
      "Title": "SPRINT #3 - 2015/05/01",
      "CompanyName": "Klick Inc.",
      "AccountPortfolioName": "Genome",
      "ProjectID": 10424,
      "ProjectName": "Genome",
      "TicketStatusID": 410,
      "TicketStatusName": "open",
      "AssigneeUserID": 5164,
      "AssigneeUserFullName": "Dan Van Brunt",
      "AssignerUserID": 4323,
      "AssignerUserFullName": "Genome ",
      "Description": "SPRINT #3 - 2015/05/01",
      "Created": "/Date(1428681997263-0000)/",
      "CreatorUserID": 3930,
      "CreatorUserFullName": "Patricia MacPherson",
      "Priority": 5,
      "Deadline": "/Date(1430517600000-0000)/",
      "ClientCanView": false,
      "Updated": "/Date(1430733631733-0000)/",
      "UpdaterUserID": 5164,
      "LastViewDate": "/Date(1432563159297-0000)/",
      "RecentComments": [],
      "ChecklistItems": []
    },
    {
      "TicketID": 804689,
      "Title": "GenomeFS - GDrive and Genome Document Management",
      "CompanyName": "Klick Inc.",
      "AccountPortfolioName": "Genome",
      "ProjectID": 10424,
      "ProjectName": "Genome",
      "TicketStatusID": 410,
      "Estimate": 5753,
      "TicketStatusName": "open",
      "AssigneeUserID": 5164,
      "AssigneeUserFullName": "Dan Van Brunt",
      "AssignerUserID": 4323,
      "AssignerUserFullName": "Genome ",
      "Description": "<div><div><b>git repo:&nbsp;</b></div><div><b>git@github.com:KlickInc/klick-genome-genomefs.git<br><br><br>MVP:</b></div><div>- For every Project in Genome, there will be a GDrive Folder structure mapped accordingly.</div></div><div>- The Folder structure is well defined and leaves no room for content confusion</div><div>- GDrive Folders will exist when Genome Projects will</div><div>- Update project page with folder URL &nbsp;http://www.screencast.com/t/fAgEX7Wv17qg</div><div><br></div><div><b>Answers needed for MVP:</b></div><div>- Does the Genome@Klick.com gdrive account get any storage hit at all when creating and sharing folders</div><div>- Do the people that accept that share get hit for storage<br>- Need to know if there are any quota limits for the api calls.&nbsp; There are 8000 enabled projects in Genome.&nbsp; <br>https://developers.google.com/apps-script/guides/services/quotas<br>- Does google provide a batch create/insert/update api call that works with nodejs client.<br></div>- Can we get realtime info from Genome on Project creation<div><br><div>- Can users UPLOAD to a shared folder - done<br></div><div>- Need to be able to tag folder with Project ID (description) - done<br></div><br></div><div><b>Considerations:</b></div><div>- Decoupled MicroService seems like the ideal choice</div><div>- Node.js primary choice so far</div><div>- Service API framework for Node: Restify<br>- Node - Google API - https://github.com/google/google-api-nodejs-client/</div><div>- Promise Library - Q</div><div>- Reactive Programming Library -&nbsp;https://pozadi.github.io/kefir/ &nbsp;similar to - &nbsp;https://baconjs.github.io/&nbsp;</div><div><br></div><div><br><br></div>",
      "Created": "/Date(1424728971967-0000)/",
      "CreatorUserID": 5164,
      "CreatorUserFullName": "Dan Van Brunt",
      "Priority": 5,
      "ClientCanView": false,
      "Updated": "/Date(1426603916000-0000)/",
      "UpdaterUserID": 3930,
      "LastViewDate": "/Date(1432584511617-0000)/",
      "RecentComments": [],
      "ChecklistItems": []
    },
    {
      "TicketID": 713182,
      "Title": "Applicant: David Hurley",
      "CompanyName": "Klick Inc.",
      "AccountPortfolioName": "Recruiting",
      "ProjectID": 17506,
      "ProjectName": "Recruiting and Interviewing",
      "TicketStatusID": 406,
      "TicketStatusName": "closed",
      "AssigneeUserID": 4714,
      "AssigneeUserFullName": "Montana McTiernan",
      "AssignerUserID": 4714,
      "AssignerUserFullName": "Montana McTiernan",
      "Description": "Applicant: David Hurley",
      "Created": "/Date(1408484144247-0000)/",
      "CreatorUserID": 4714,
      "CreatorUserFullName": "Montana McTiernan",
      "Priority": 5,
      "ClientCanView": false,
      "Updated": "/Date(1408484144250-0000)/",
      "UpdaterUserID": 4714,
      "RecentComments": [],
      "ChecklistItems": []
    }
  ],
  "Validation": {
    "IsValid": true
  },
  "ExecutionTime": "492ms"
}*/

(function() {
    var app = angular.module('testing', ['ngSanitize']);
    app.controller('myCtrl', ['$http', '$scope', function($http, $scope) {
      // api call to get current user's id
        $http.jsonp("https://genome.klick.com:443/api/User/Current?callback=JSON_CALLBACK")
        .success(function(user) {
            var user_id = user.Entries[0].UserID;
            // with the user's id, getting the user's open tickets 
            $http.jsonp("https://genome.klick.com:443/api/Ticket/Filter?callback=JSON_CALLBACK&AssignedToUserID=" + user_id + "&TicketStatusIsOpen=true&MaxRecords=100")
            .success(function(data) {
                $scope.all_tasks = [];
                for (var x = 0; x < data.NumEntries; x++) {
                    var temp_info = {};
                    temp_info["title"] = data.Entries[x].Title;
                    if (temp_info["title"].length > 57) {
                        temp_info["title"] = temp_info["title"].substring(0, 57) + "...";
                    }
                    temp_info["task_id"] = data.Entries[x].TicketID;
                    temp_info["desc"] = data.Entries[x].Description;
                    temp_info["current_user"] = user_id;
                    $scope.all_tasks.push(temp_info);
                };
                $scope.showModal = function(id) {
                    $scope.modal_data = {};
                    $http.jsonp("http://genome.klick.com:80/api/Ticket/Comment?callback=JSON_CALLBACK&TicketID=" + id)
                    .success(function(comment) {
                        if (comment.NumEntries == 0) {
                            $scope.modal_data["has_comments"] = false;
                            $scope.modal_data["comment_info"] = [];
                        }
                        else {
                            $scope.modal_data["has_comments"] = true;
                            // convert the unix date stamp to a readable format using momentjs
                            for (var each_comment = 0; each_comment < comment.NumEntries; each_comment++) {
                                var c_time = comment.Entries[each_comment].Created;
                                comment.Entries[each_comment].Created = moment(c_time).fromNow();
                                var c_user_img = comment.Entries[each_comment].UserPhotoPath;
                                comment.Entries[each_comment].UserPhotoPath = "background: url('http://genome.klick.com" + c_user_img + "') no-repeat center center; background-size: cover;";
                            }
                            $scope.modal_data["comment_info"] = comment;
                        }
                        console.log($scope.modal_data);
                    });
                    $http.jsonp("https://genome.klick.com:443/api/Ticket/Filter?callback=JSON_CALLBACK&TicketID=" + id)
                    .success(function(user_info) {
                        $scope.modal_data['task_desc'] = user_info.Entries[0].Description;
                        $scope.modal_data['task_title'] = user_info.Entries[0].Title;
                    });
                };
            });
        });
    }]);
})();

$(document).ready(function() {

    $(".fab").click(function() {
        alert($(this).attr('id'));
    });

    $(".hamburger-icon").click(function() {
        //openSidebar();
        $(".sidebar").addClass("sb-open");
        $(".page-shadow").addClass("ps-on");
    });

    $(".page-shadow").click(function() {
        //closeSidebar();
        $(".sidebar").removeClass("sb-open");
        $(".page-shadow").removeClass("ps-on");
    });

    $(".search-icon-right").click(function() {
        $(this).css("display", "none");
        $(".navbar").css("background", "#FFF");
        $(".input-group").css("left", "70px");
        $(".back-icon").css("display", "block");
        $(".clear-icon-right").css("display", "block");
        $("#search-box").focus();
    });

    $(".dd-icon-right").click(function() {
        $(".dropdown ul").css("transform", "scale(1)");
    })

    $(".clear-icon-right").click(function() {
        $("#search-box").val("");
        $("#search-box").focus();
    });

    $(".back-icon").click(function() {
        $(this).css("display", "none");
        $(".clear-icon-right").css("display", "none");
        $(".navbar").css("background", "#3F51B5");
        $(".input-group").css("left", "-7000px");
        $(".back-icon").css("display", "none");
        $(".search-icon-right").css("display", "block");
    });

    $("body").click(function() {
        $(".dropdown").css("-webkit-transition", "scale(0)");
    })

    $(document).keyup(function(e) {
    //if (e.keyCode == 13) $('.save').click();     // enter
        if (e.keyCode == 27) {
            $(".clear-icon-right").css("display", "none");
            $(".navbar").css("background", "#3F51B5");
            $(".input-group").css("left", "-7000px");
            $(".back-icon").css("display", "none");
            $(".search-icon-right").css("display", "block");
        }
    });

    function openSidebar() {
        $(".sidebar").css("left", "0px");
        $(".page-shadow").css("left", "300px");
        $(".page-shadow").css("width", "calc(100% - 300px)");
        $(".page-shadow").css("z-index", "10000");
        $(".page-shadow").css("background-color", "rgba(0,0,0,0.5)");
        $("body").css("overflow-y", "hidden");
    }

    function closeSidebar() {
        $(".sidebar").css("left", "-300px");
        $(".page-shadow").css("left", "0px");
        $(".page-shadow").css("width", "100%");
        $(".page-shadow").css("background-color", "rgba(0,0,0,0)");
        $(".page-shadow").css("z-index", "-5");
        $("body").css("overflow-y", "auto");
    }
});
